<Window x:Class="LanguageSchoolERP.App.Windows.StudentProfileWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Student Profile" Height="780" Width="1150"
        WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <Style x:Key="EditableTextBoxStyle" TargetType="TextBox">
            <Setter Property="IsReadOnly" Value="True"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEditing}" Value="True">
                    <Setter Property="IsReadOnly" Value="False"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="EditButtonStyle" TargetType="Button">
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEditing}" Value="True">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="EditModeButtonStyle" TargetType="Button">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEditing}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="EditableDatePickerStyle" TargetType="DatePicker">
            <Setter Property="IsEnabled" Value="False"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEditing}" Value="True">
                    <Setter Property="IsEnabled" Value="True"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ContractSelectionActionButtonStyle" TargetType="Button">
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.SelectedContract, RelativeSource={RelativeSource AncestorType=Window}}" Value="{x:Null}">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ProgramSelectionActionButtonStyle" TargetType="Button">
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.SelectedProgram, RelativeSource={RelativeSource AncestorType=Window}}" Value="{x:Null}">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PaymentSelectionActionButtonStyle" TargetType="Button">
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.SelectedPayment, RelativeSource={RelativeSource AncestorType=Window}}" Value="{x:Null}">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding DataContext.SelectedPayment.IsSyntheticEntry, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel>
                <TextBlock Text="{Binding FullName}" FontSize="22" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding ContactLine}" Foreground="#666666" Margin="0,4,0,0"/>
                <TextBlock Text="{Binding ActiveStatusText}" Foreground="#444444" FontWeight="SemiBold" Margin="0,4,0,0"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Top">
                <TextBlock Text="Academic Year:" VerticalAlignment="Center" Margin="0,0,8,0" LineHeight="20"/>
                <ComboBox Width="140" VerticalAlignment="Center"
                          ItemsSource="{Binding AvailableAcademicYears}"
                          SelectedItem="{Binding LocalAcademicYear}"/>
            </StackPanel>
        </Grid>

        <!-- Summary -->
        <Border Grid.Row="1" Margin="0,14,0,14" Padding="12" CornerRadius="10" BorderBrush="#DDDDDD" BorderThickness="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="260"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Enrollment Summary" Foreground="#666666"/>
                    <TextBlock Text="{Binding EnrollmentSummaryLine}" FontWeight="SemiBold" Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="18,0,0,0">
                    <TextBlock Text="Agreement" Foreground="#666666" FontSize="12" HorizontalAlignment="Right"/>
                    <TextBlock Text="{Binding AgreementText}" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Margin="18,0,0,0">
                    <TextBlock Text="Paid" Foreground="#666666" FontSize="12" HorizontalAlignment="Right"/>
                    <TextBlock Text="{Binding PaidText}" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                </StackPanel>

                <StackPanel Grid.Column="3" Margin="18,0,0,0">
                    <TextBlock Text="Balance" Foreground="#666666" FontSize="12" HorizontalAlignment="Right"/>
                    <TextBlock Text="{Binding BalanceText}" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                </StackPanel>

                <StackPanel Grid.Column="4" Margin="18,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="{Binding ProgressText}" Foreground="#666666" FontSize="12"/>
                    <ProgressBar Height="14" Minimum="0" Maximum="100" Value="{Binding ProgressPercent}" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tabs -->
        <TabControl Grid.Row="2">
            <TabItem Header="Profile">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <DockPanel Grid.Row="0" Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                                <Button Content="Edit"
                                        Width="90"
                                        Margin="0,0,8,0"
                                        Style="{StaticResource EditButtonStyle}"
                                        Command="{Binding EditProfileCommand}"/>
                                <Button Content="Save"
                                        Width="90"
                                        Margin="0,0,8,0"
                                        Style="{StaticResource EditModeButtonStyle}"
                                        Command="{Binding SaveProfileCommand}"/>
                                <Button Content="Cancel"
                                        Width="90"
                                        Style="{StaticResource EditModeButtonStyle}"
                                        Command="{Binding CancelEditCommand}"/>
                                <Button Content="Delete Student"
                                        Width="120"
                                        Margin="10,0,0,0"
                                        Background="#B00020"
                                        Foreground="White"
                                        Command="{Binding DeleteStudentCommand}"/>
                            </StackPanel>
                        </DockPanel>

                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Student" FontWeight="SemiBold" Margin="0,0,0,10"/>

                                <TextBlock Text="Student Name" Foreground="#666666" FontSize="12"/>
                                <TextBox Text="{Binding EditableStudentName, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Student Surname" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditableStudentSurname, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Date of Birth" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <DatePicker SelectedDate="{Binding EditableDateOfBirth}" Style="{StaticResource EditableDatePickerStyle}"/>

                                <TextBlock Text="Phone" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditablePhone, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Email" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditableEmail, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Notes" FontWeight="SemiBold" Margin="0,16,0,6"/>
                                <TextBox Text="{Binding EditableNotes, UpdateSourceTrigger=PropertyChanged}" TextWrapping="Wrap" AcceptsReturn="True" MinHeight="80" Style="{StaticResource EditableTextBoxStyle}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Parents" FontWeight="SemiBold" Margin="0,0,0,10"/>

                                <TextBlock Text="Father Name" Foreground="#666666" FontSize="12"/>
                                <TextBox Text="{Binding EditableFatherName, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Father Surname" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditableFatherSurname, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Father Phone" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditableFatherPhone, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Father Email" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditableFatherEmail, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Mother Name" Foreground="#666666" FontSize="12" Margin="0,12,0,0"/>
                                <TextBox Text="{Binding EditableMotherName, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Mother Surname" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditableMotherSurname, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Mother Phone" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditableMotherPhone, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>

                                <TextBlock Text="Mother Email" Foreground="#666666" FontSize="12" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding EditableMotherEmail, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource EditableTextBoxStyle}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </TabItem>


            <TabItem Header="Programs">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel LastChildFill="False">
                        <TextBlock DockPanel.Dock="Left" Text="Program Enrollments" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                            <Button Content="Add Program" Width="120" Margin="0,0,8,0" Command="{Binding AddProgramCommand}"/>
                            <Button Content="Edit" Width="110" Margin="0,0,8,0" Command="{Binding EditSelectedProgramCommand}" Style="{StaticResource ProgramSelectionActionButtonStyle}"/>
                            <Button Content="Remove"
                                    Width="110"
                                    Command="{Binding RemoveSelectedProgramCommand}"
                                    Style="{StaticResource ProgramSelectionActionButtonStyle}"
                                    Background="#B00020"
                                    BorderBrush="#8C0019"
                                    Foreground="White"/>
                        </StackPanel>
                    </DockPanel>

                    <Border Grid.Row="1" Margin="0,10,0,0" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="8">
                        <DataGrid ItemsSource="{Binding Programs}"
                                  SelectedItem="{Binding SelectedProgram}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Program" Binding="{Binding ProgramText}" Width="130"/>
                                <DataGridTextColumn Header="Level/Class" Binding="{Binding LevelOrClassText}" Width="120"/>
                                <DataGridTextColumn Header="Agreement" Binding="{Binding AgreementTotalText}" Width="110"/>
                                <DataGridTextColumn Header="Books" Binding="{Binding BooksText}" Width="100"/>
                                <DataGridTextColumn Header="Downpayment" Binding="{Binding DownPaymentText}" Width="120"/>
                                <DataGridTextColumn Header="Installments" Binding="{Binding InstallmentsText}" Width="150"/>
                                <DataGridTextColumn Header="Installment Amount" Binding="{Binding InstallmentAmountText}" Width="140"/>
                                <DataGridTextColumn Header="Status" Binding="{Binding StatusText}" Width="90"/>
                                <DataGridTextColumn Header="Comments" Binding="{Binding CommentsText}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </TabItem>

            <TabItem Header="Payments">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel LastChildFill="False">
                        <TextBlock DockPanel.Dock="Left" Text="Payments" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                            <Button Content="Add Payment" Width="120" Margin="0,0,8,0" Command="{Binding AddPaymentCommand}"/>
                            <Button Content="Edit" Width="100" Margin="0,0,8,0" Command="{Binding EditPaymentCommand}" Style="{StaticResource PaymentSelectionActionButtonStyle}"/>
                            <Button Content="Delete" Width="100" Command="{Binding DeletePaymentCommand}" Style="{StaticResource PaymentSelectionActionButtonStyle}" Background="#B00020" BorderBrush="#8C0019" Foreground="White"/>
                        </StackPanel>
                    </DockPanel>

                    <Border Grid.Row="1" Margin="0,10,0,0" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="8">
                        <DataGrid ItemsSource="{Binding Payments}"
                                  SelectedItem="{Binding SelectedPayment}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  CanUserAddRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Type" Binding="{Binding TypeText}" Width="140"/>
                                <DataGridTextColumn Header="Date" Binding="{Binding DateText}" Width="140"/>
                                <DataGridTextColumn Header="Amount" Binding="{Binding AmountText}" Width="140"/>
                                <DataGridTextColumn Header="Method" Binding="{Binding Method}" Width="120"/>
                                <DataGridTextColumn Header="Reason" Binding="{Binding ReasonText}" Width="150"/>
                                <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </TabItem>

            <TabItem Header="Receipts">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel LastChildFill="False">
                        <TextBlock DockPanel.Dock="Left" Text="Receipts" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <Button DockPanel.Dock="Right"
                                Content="Print Receipt"
                                Width="140"
                                Command="{Binding PrintReceiptCommand}"/>
                    </DockPanel>

                    <DataGrid Grid.Row="1"
                              Margin="0,10,0,0"
                              ItemsSource="{Binding Receipts}"
                              SelectedItem="{Binding SelectedReceipt}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False">
						<DataGrid.Columns>
							<DataGridTextColumn Header="Receipt #" Binding="{Binding NumberText}" Width="100"/>
							<DataGridTextColumn Header="Date" Binding="{Binding DateText}" Width="120"/>
							<DataGridTextColumn Header="Amount" Binding="{Binding AmountText}" Width="120"/>
							<DataGridTextColumn Header="Method" Binding="{Binding MethodText}" Width="120"/>
							<DataGridTextColumn Header="Reason" Binding="{Binding ReasonText}" Width="150"/>
							<DataGridTextColumn Header="Program" Binding="{Binding ProgramText}" Width="*"/>
						</DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="Contracts">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel>
                        <DockPanel LastChildFill="False">
                            <TextBlock DockPanel.Dock="Left" Text="Contracts" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                                <Button Content="Create" Width="140" Margin="0,0,8,0" Command="{Binding CreateContractCommand}"/>
                                <Button Content="Edit" Width="120" Margin="0,0,8,0" Command="{Binding EditContractCommand}" Style="{StaticResource ContractSelectionActionButtonStyle}"/>
                                <Button Content="Print" Width="120" Margin="0,0,8,0" Command="{Binding ExportContractPdfCommand}" Style="{StaticResource ContractSelectionActionButtonStyle}"/>
                                <Button Content="Delete"
                                        Width="120"
                                        Command="{Binding DeleteContractCommand}"
                                        Style="{StaticResource ContractSelectionActionButtonStyle}"
                                        Background="#C0392B"
                                        BorderBrush="#A93226"
                                        Foreground="White"/>
                            </StackPanel>
                        </DockPanel>
                        <TextBlock Margin="0,8,0,0" Foreground="#C0392B" FontWeight="SemiBold" Text="{Binding PendingContractsText}"/>
                    </StackPanel>

                    <Border Grid.Row="1" Margin="0,10,0,0" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="8">
                        <DataGrid ItemsSource="{Binding Contracts}"
                                  SelectedItem="{Binding SelectedContract}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  CanUserAddRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Created At" Binding="{Binding CreatedAtText}" Width="180"/>
                                <DataGridTextColumn Header="Program" Binding="{Binding ProgramText}" Width="*"/>
                                <DataGridTextColumn Header="Pending" Binding="{Binding IsPendingPrint}" Width="90"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
